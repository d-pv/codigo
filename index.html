<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8"> 
	
	<title>C&oacute;digo Secreto</title>
    <link rel="shortcut icon" href="./img/favicon.ico" />

	<style>
		*{
			margin:0;
			padding:0;
			border:0;
			background-color: #ddd;
			box-sizing: border-box;
			font-family: sans-serif;
		}
		
		.carta{
			float: left;
			margin-top: 11vh;
			margin-bottom: -10vh;
			border-radius: 0.75vw;
			border: 1px solid #222;
			background-color: #e9d9c9;
			width: 19%;
			margin-left: 0.5%;
			margin-right: 0.5%;
			height: 21.5vh;
			background-size: contain;
			background-position: center;
			background-repeat: no-repeat;
			cursor: pointer;
			text-align: center;
			z-index: 0;
			//padding-top: 8vh;
			//line-height: 5vh;
			text-transform: uppercase;
			font-weight: bold;
		}
		
		.carta > .texto{
		    /*background-color: #e9d9c9;*/
		    background-color: rgba(0,0,0,0);
		}
		
		.top{
			position: absolute;
			width: 100vw;
			height: 10vh;
			text-align: center;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		
		.top div{
			float:left;
			width: 26.6%;
			margin:0;
			padding: 2vh;
			height: 8vh;
			font-size: 2vw;
			text-align:center;
		}
		
		.top .icon{
			width: 10%;
			max-width: 8vh;
			height: 8vh;
			background-size: contain;
			background-position: center;
			background-repeat: no-repeat;
			cursor: pointer;
			border-radius: 2vh;
		}
		
		.top #icon_right{
			background-image: url('./img/max2.png');
			background-color: #222;
			box-shadow: 0px 0px 5px 1px rgba(0,0,0,0.5);
		}
		
		.top input{
			width: 100%;
			font-size: 2vw;
			border-radius: 2vh;
			margin-top: -2vh;
			padding: 1vh;
			text-align: left;
			height:8vh;
		}
		
		.top .button{
			width: 20%;
			margin: 0 3.3% 0 3.3%;
		}
		
		.button{
			height: 8vh;
			min-height: 8vh;
			background-color: #222;
			color: #fefefe;
			cursor: pointer;
			border-radius: 2vh;
			padding: 1vh;
			box-shadow: 0px 0px 5px 1px rgba(0,0,0,0.5);
		}
		.selector{
			position: absolute;
			margin-top: 10vh;
			margin-left: auto;
			margin-right: auto;
			font-size: 2vw;
			top: 8vh;
			left:0;
			width: 100vw;
			text-align: center;
			z-index:0;
		}
		
		.entrada{
			border: 1px solid #bbb;
			background-color: #fff;
			color: #000;
			width: 20vw;
		}
		
		.overlay{
			border-radius: 0.75vw;
			position: relative;
			left:0;
			top:0;
			padding: 3vh;
			height: 100%;
			width: 100%;
			background-color: rgba(128,128,128,0.5);
			text-align: center;
			z-index: 2;
			text-transform: none;
			font-weight: normal;
		}
		
		.overlay > div{
			position: relative;
			margin-top: 0vh;
			margin-bottom: 1vh;
			border-radius: 2vh;
			padding: 1vh;
			height: 6vh;
			font-size: 4vh;
			cursor: pointer;
			background-color:#009b58;
			border: 1px solid #007b36;
			color: #fff;
			overflow:hidden;
		}
		
		.overlay > div:nth-child(2){
			margin-top: 0vh;
			margin-bottom: 0vh;
			background-color: #e82c0c;
			border: 1px solid #c60a0a;
		}
		
		#container-tablero{
			display: none;
			visibility: hidden;
			z-index:1;
		}
		
		#fondo{
			position: absolute;
			z-index:-10;
			left:0;
			top:0;
			width:100%;
			height: 100%;
		}
		
		#girar-telefono{
			position: absolute;
			z-index:100;
			left:0;
			top:0;
			width:100%;
			height: 100%;
			visibility: hidden:
			display: none;
			background-color: rgba(44,44,44,0.95);
			background-image: url('./img/rotate.gif');
			background-size: contain;
			background-repeat: no-repeat;
			background-position: center;
			color: #fff;
			font-size: 4vh;
			padding: 10vh;
		}
		
		.mensaje{
			position: absolute;
			left:10%;
			top:10vh;
			width:80%;
			height: 80vh;
			background-color: #ffffff;
			border: 1px solid #aaa;
			border-radius: 2vh;
			box-shadow: 1vh 1vh 5vh 1vh #888;
			padding: 2vh;
			visibility: hidden;
		}
		
		.mensaje *{
			background-color: #ffffff;
			text-align: left;
			font-size: 4vh;
		}
		
		.mensaje > .titulo{
			position:relative;
			float:left;
			margin:0;
			top:0;
			left:0;
			width: 90%;
			height: 6vh;
			padding-top: 1vh;
			padding-left: 2vh;
			text-align: left;
			font-weight: bold;
		}
		.mensaje > .cerrar{
			position:relative;
			float:left;
			margin:0;
			top:0;
			width: 10%;
			height: 6vh;
			font-size:6vh;
			padding-top: 0vh;
			padding-right: 2vh;
			text-align: right;
			cursor: pointer;
		}
		
		.mensaje > .contenido{
			margin:0;
			padding:2vh;
			top: 10%;
			left:0;
			width: 100%;
			height: 70vh;
			overflow: auto;
		}
		
		.boton-novedades{
		    position: fixed;
		    right: 20px;
		    bottom: 20px;
		    width: 60px;
		    height: 60px;
		    font-size: 40px;
		    line-height: 40px;
		    padding-top: 20px;
		    background-color: #222;
		    color: #fefefe;
		    border-radius: 30px;
		    cursor: pointer;
		    box-shadow: 0px 0px 5px 1px rgba(0,0,0,0.5);
		}
		
		.boton-novedades:hover{
		    background-color: #fefefe;
		    color: #222;
		}
		
		.novedades-caption{
            background-color: #222;
            color: #fefefe;
            position: fixed;
            width: auto;
            height: 30px;
            bottom: 35px;
            font-weight: bold;
            right: 90px;
            opacity: 0.8;
            cursor: pointer;
            font-size: 15px;
            line-height: 15px;
            padding: 7.5px 10px 7.5px 10px;
            animation: rebotar 1s ease-in-out infinite;
            border-radius: 3.25px;
        }
        
        .novedades-caption:before{
            content: "";
            position: absolute;
            top: 10px; /*0.5*((altura del alert caption) - (altura de este elemento))*/
            right: -10px; /* (altura de este elemento) */
            z-index: 1;
            border: solid 5px transparent; /* La mitad de la altura de este elemento*/
            border-right-color: #222;
            transform: rotate(180deg);
        }
        
        @keyframes rebotar {
            0%, 20%, 50%, 80%, 100% {transform: translateX(0);} 
            40% {transform: translateX(-20px);} 
            60% {transform: translateX(-10px);}
        }
        .novedades-caption:hover{
            opacity: 1;
        }
        
        #modo_juego, #modo_juego>option{
            font-size: 2vw;
            background-color: #222;
            color: #fefefe;
        }
        #modo_juego{
            border: 1px solid #000;
            box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.5);
            border-radius: 2vh;
            padding: 3px;
        }
		
	</style>
</head>
<body>
	<div class="mensaje" id="mensaje1">
		<div class="titulo" id="mensaje1_titulo">Título del mensaje</div>
		<div class="cerrar" onclick="cerrar_ventana('mensaje1')">×</div>
		<div class="contenido" id="mensaje1_contenido">Contenido</div>
	</div>
	
	<!--<div id="girar-telefono">
		Por favor, gira el dispositivo.
	</div>-->
	
	<audio id="cancion" preload="none" onended="acabada();"><source id="fichero" src=""></audio>
	<div id="fondo">
		<div class="top">
			<div class="icon" id="icon_left" onclick=""></div>
			<div style="text-align:right;"><span> N&uacute;mero de juego:</span></div>
			<div><input type="text" id="tablero" value="0" class="entrada"></div>
			<div class="button" onclick="actualizar()">&nbsp;Nueva Partida&nbsp;</div>
			<div class="icon" id="icon_right" onclick="ventanaCompleta()"></div>
			<!--
			<div class="icon" id="icon_left" onclick="ventanaCompleta()"></div>
			<div style="text-align:right;"><span> N&uacute;mero de juego:</span></div>
			<div><input type="number" id="tablero" value="0" class="entrada"></div>
			<div><span class="button" onclick="actualizar()">&nbsp;Actualizar&nbsp;</span></div>
			<div class="icon" id="icon_right" onclick="ventanaCompleta()"></div>
			-->
		</div>
		
		<div class="selector" id="container-selector">
			<br/>
			<span style="font-size: 3vw;">Código Secreto</span>
			<div style="font-size: 1.2vw;">
				<p>Para jugar a este juego se necesitan dos dispositivos.</p>
				<p>Lo ideal es un m&oacute;vil para el c&oacute;digo y un port&aacute;til/tablet para el tablero.</p>
				<br/>
				<p>Aseg&uacute;rate que el n&uacute;mero de juego es el mismo en los dos dispositivos.</p>
				<p>Si los dos dispositivos tienen la misma (30s de diferencia),</p>
				<p>carga la p&aacute;gina a la vez en ambos para que se ponga el mismo n&uacute;mero de juego.</p>
				<br/>
				<span style="font-size:2vw">Modo de juego:</span><br/>
				<select id="modo_juego">
                  <option value="0">Imágenes o palabras (aleatorio)</option>
                  <option value="1">Sólo imágenes</option>
                  <option value="2">Sólo palabras</option>
                </select>
			</div>
			<br/>
			¿Qu&eacute; quieres mostrar en este dispositivo?
			<br/><br/>
			<span class="button big" onclick="mostrarTablero()">&nbsp;Tablero de cartas&nbsp;</span>
			&nbsp;&nbsp;&nbsp;
			<span class="button big" onclick="mostrarCodigo()">&nbsp;Tarjeta de c&oacute;digo secreto&nbsp;</span>
			<div class="boton-novedades" onclick="novedades();">*</div>
			<div class="novedades-caption" onclick="novedades();">Novedades</div>
		</div>
		
		<div id="container-tablero">
			<!-- Creamos el tablero de cartas. Cada carta se llama aN, donde N es un número entre 0 y el número de cartas menos 1. Asignamos en principio el equipo 0 (civiles) a todas las cartas. Al pulsar en cada carta, se muestra el overlay.
			Los overlays se llaman bN y tienen dos botones dentro: Uno para revelar el agente (ejecuta la función mostraragente) y otro para ocultar el overlay (ejecuta la función ocultar overlay)-->
			<!--<div class="carta" id="a0"  data-team="0" onclick="mostraroverlay(0)">  <div class="overlay" id="b0"  style="visibility: hidden;"> <div onclick="mostraragente(0)"> Revelar</div> <div onclick="ocultaroverlay(0)"> Cancelar</div> </div> </div>
			<div class="carta" id="a1"  data-team="0" onclick="mostraroverlay(1)">  <div class="overlay" id="b1"  style="visibility: hidden;"> <div onclick="mostraragente(1)"> Revelar</div> <div onclick="ocultaroverlay(1)"> Cancelar</div> </div> </div>
			<div class="carta" id="a2"  data-team="0" onclick="mostraroverlay(2)">  <div class="overlay" id="b2"  style="visibility: hidden;"> <div onclick="mostraragente(2)"> Revelar</div> <div onclick="ocultaroverlay(2)"> Cancelar</div> </div> </div>
			<div class="carta" id="a3"  data-team="0" onclick="mostraroverlay(3)">  <div class="overlay" id="b3"  style="visibility: hidden;"> <div onclick="mostraragente(3)"> Revelar</div> <div onclick="ocultaroverlay(3)"> Cancelar</div> </div> </div>
			<div class="carta" id="a4"  data-team="0" onclick="mostraroverlay(4)">  <div class="overlay" id="b4"  style="visibility: hidden;"> <div onclick="mostraragente(4)"> Revelar</div> <div onclick="ocultaroverlay(4)"> Cancelar</div> </div> </div>
			<div class="carta" id="a5"  data-team="0" onclick="mostraroverlay(5)">  <div class="overlay" id="b5"  style="visibility: hidden;"> <div onclick="mostraragente(5)"> Revelar</div> <div onclick="ocultaroverlay(5)"> Cancelar</div> </div> </div>
			<div class="carta" id="a6"  data-team="0" onclick="mostraroverlay(6)">  <div class="overlay" id="b6"  style="visibility: hidden;"> <div onclick="mostraragente(6)"> Revelar</div> <div onclick="ocultaroverlay(6)"> Cancelar</div> </div> </div>
			<div class="carta" id="a7"  data-team="0" onclick="mostraroverlay(7)">  <div class="overlay" id="b7"  style="visibility: hidden;"> <div onclick="mostraragente(7)"> Revelar</div> <div onclick="ocultaroverlay(7)"> Cancelar</div> </div> </div>
			<div class="carta" id="a8"  data-team="0" onclick="mostraroverlay(8)">  <div class="overlay" id="b8"  style="visibility: hidden;"> <div onclick="mostraragente(8)"> Revelar</div> <div onclick="ocultaroverlay(8)"> Cancelar</div> </div> </div>
			<div class="carta" id="a9"  data-team="0" onclick="mostraroverlay(9)">  <div class="overlay" id="b9"  style="visibility: hidden;"> <div onclick="mostraragente(9)"> Revelar</div> <div onclick="ocultaroverlay(9)"> Cancelar</div> </div> </div>
			<div class="carta" id="a10" data-team="0" onclick="mostraroverlay(10)"> <div class="overlay" id="b10" style="visibility: hidden;"> <div onclick="mostraragente(10)">Revelar</div> <div onclick="ocultaroverlay(10)">Cancelar</div> </div> </div>
			<div class="carta" id="a11" data-team="0" onclick="mostraroverlay(11)"> <div class="overlay" id="b11" style="visibility: hidden;"> <div onclick="mostraragente(11)">Revelar</div> <div onclick="ocultaroverlay(11)">Cancelar</div> </div> </div>
			<div class="carta" id="a12" data-team="0" onclick="mostraroverlay(12)"> <div class="overlay" id="b12" style="visibility: hidden;"> <div onclick="mostraragente(12)">Revelar</div> <div onclick="ocultaroverlay(12)">Cancelar</div> </div> </div>
			<div class="carta" id="a13" data-team="0" onclick="mostraroverlay(13)"> <div class="overlay" id="b13" style="visibility: hidden;"> <div onclick="mostraragente(13)">Revelar</div> <div onclick="ocultaroverlay(13)">Cancelar</div> </div> </div>
			<div class="carta" id="a14" data-team="0" onclick="mostraroverlay(14)"> <div class="overlay" id="b14" style="visibility: hidden;"> <div onclick="mostraragente(14)">Revelar</div> <div onclick="ocultaroverlay(14)">Cancelar</div> </div> </div>
			<div class="carta" id="a15" data-team="0" onclick="mostraroverlay(15)"> <div class="overlay" id="b15" style="visibility: hidden;"> <div onclick="mostraragente(15)">Revelar</div> <div onclick="ocultaroverlay(15)">Cancelar</div> </div> </div>
			<div class="carta" id="a16" data-team="0" onclick="mostraroverlay(16)"> <div class="overlay" id="b16" style="visibility: hidden;"> <div onclick="mostraragente(16)">Revelar</div> <div onclick="ocultaroverlay(16)">Cancelar</div> </div> </div>
			<div class="carta" id="a17" data-team="0" onclick="mostraroverlay(17)"> <div class="overlay" id="b17" style="visibility: hidden;"> <div onclick="mostraragente(17)">Revelar</div> <div onclick="ocultaroverlay(17)">Cancelar</div> </div> </div>
			<div class="carta" id="a18" data-team="0" onclick="mostraroverlay(18)"> <div class="overlay" id="b18" style="visibility: hidden;"> <div onclick="mostraragente(18)">Revelar</div> <div onclick="ocultaroverlay(18)">Cancelar</div> </div> </div>
			<div class="carta" id="a19" data-team="0" onclick="mostraroverlay(19)"> <div class="overlay" id="b19" style="visibility: hidden;"> <div onclick="mostraragente(19)">Revelar</div> <div onclick="ocultaroverlay(19)">Cancelar</div> </div> </div>-->
		</div>
	</div>

<script src="./js/mersenne-twister.js" type="text/javascript"></script> 
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script>
	
	function shuffle(N,generator){ // Esta función se usa para barajear un array de N elementos desde 0 hasta N.
		
		var array = Array.apply(null, {length: N}).map(Number.call, Number); // Array desde 0 hasta N-1, con N elementos, ordenados => este es el que hay que barajear.
		var idx = array.length, temp, rndix; // inicializamos variables
		while (0!== idx){ // Como empezamos por la longitud del array, hasta que no se llegue a 0, sigue haciendo.
			rndix = Math.floor(generator.random()*idx); // Generamos un número aleatorio entero entre 0 y la posición actual menos 1. Vamos a intercambiar el valor en la posción actual con el valor en la posición que nos salga aquí.
			idx--; 						// restamos uno a la posición actual (para que la coja bien, ya que esto está en índice empezando en 0).
			temp = array[idx];         	// guardamos en la variable temporal el valor en la posición actual.
			array[idx] = array[rndix];	// En la posición actual ponemos el valor de la posición que nos ha tocado.
			array[rndix] = temp;		// En la posición que ha tocado ponemos el valor que había anteriormente en la posción actual.
		}
		return array;
	}

	function pad(num, size) { // Esta función nos pone ceros delante de un número hasta conseguir la longitud mínima deseada
	    var s = num + ""; // convertimos el número a string
	    while (s.length < size) s = "0" + s;
	    return s; // nos devuelve el string con la longitud mínima deseada
	}
	
	function actualizar(){ // Esta función cambia la semilla y muestra la ventana principal de nuevo. Llama a establecerSemilla y mostrarSelector
		var semilla_old = getTablero(); // cogemos la semilla antigua
		establecerSemilla(); // establecemos una semilla en función de la hora
		var semilla_new = getTablero(); // cogemos la semulla nueva
		
		//if (semilla_new!==semilla_old){ // si las semillas son diferentes
			EstaTarjetaEsCodigo = false; // Indicamos que esta tarjeta no es de código. Esto permite elegir qué información mostrar en el dispositivo
			mostrarSelector();   // mostramos el selector de juego (tablero o carta de código)
		//}
	}
	
	function refrescar(){ // En esta función vamos a actualizar todo el tablero y los códigos, al haber modificado las semillas. Llama a la función tablero
		tablero();
	}
	
	var arr;
	var empieza_azul = false; // una variable que nos dice si el equipo que empieza es el azul.
	var adiconal = 0;
	function tablero(){ // Esta función establece las cartas que aparecen y el equipo al que pertence cada carta. Llama a la función MersenneTwister, shuffle, pad
		var seedt = getTablero(); // Cogemos la semilla para las imágenes del tablero
		var seedc = seedt; //getTablero();  // Cogemos la semilla para el código de agentes
		var cartas  = new MersenneTwister(seedt); // Generador de números aleatorios para las imágenes del tablero
		var agentes = new MersenneTwister(seedc); // Generador de números aleatorios para los códigos de agentes secretos
		
		var modo_juego = $('#modo_juego').find(":selected").val();
		//alert(modo_juego);
		if (modo_juego=="0"){ //Aleatorio
		    adicional = (cartas.random()>0.5);
		}else{
		    if (modo_juego=="1"){ //Solo imagenes
		        adicional = 0;
		    }else{
		        adicional = 1; // Solo palabras
		    }
		}
		
		var Nrows = 4+adicional; // Las cartas se disponen en 4 filas y 5 columnas
		var Ncols = 5;
		empieza_azul = (agentes.random()>=0.5); // Determinamos quién es el jugador que comienza. Si el generador de números aleatorios para los agentes genera un número mayor o igual que 0.5, empiezan los azules
		
		var carta_height = (86-3*adicional)/Nrows;
		var rojo  = 7+adicional+1-empieza_azul;  // En principio sólo hay 7 agentes rojos.
		var azul  = 7+adicional+empieza_azul;  // En principio sólo hay 7 agentes azules.
		
		words = ["ábaco","abadía","abdomen","abeja","abogado","abrazadera","abrigo","abuso","acantilado","acceso","accidente","acelerador","acelga","ácido","acompañante","acorazado","acorde","acordeón","acrílico","actitud","actividad","actor","actriz","acuerdo","acuífero","acupuntura","acústico","adaptador","adiccion","adrenalina","adulto","aerolínea","aeropuerto","aftershave","agencia","agenda","agente","agua","aguja","agujero","airbag","aire","ajedrez","ajuste","alarma","alba","albañilería","albatros","alcachofa","alcantarilla","alcohol","aleación","Alemania","alergólogo","alfabeto","alfiler","alfombra","álgebra","algodón","aliento","almanaque","almeja","almendra","almohada","alojamiento","alpaca","alpes","alternativa","altitud","alto","aluminio","amargo","amazonas","ambición","ambulancia","amistad","ampolla","anagrama","analgesia","análisis","analogía","anatomía","ancho","ángel","ángulo","angustia","anillo","animado","animal","anorak","ansiedad","antártida","antílope","antorcha","antropología","anual","anuncio","aparato","apariencia","apéndice","aperitivo","aplauso","applewood","apuesta","araña","arbusto","arco","arco iris","ardilla","área","arena","argumento","aritmética","arma","armada","armadura","armamento","armario","arqueología","arquero","arquitectura","arroyo","arte","artesano","artículo","artífice","asfalto","asistente","aspecto","aspiradora","asterisco","astillero","astronomía","asunto","ataque","ataúd","ático","atletismo","atmósfera","átomo","atrio","audiencia","aula","autobús","autómata","autopista","autor","avalancha","avance","avenida","avión","ayuda","azafrán","azteca","azul","babosa","babuino","bacalao","bahía","baile","bajo","bala","balalaika","balcón","ballena","ballet","baloncesto","bambú","banco","banda","bandolera","banquero","bañera","baño","bar","barba","barbacoa","barbero","barbilla","barbitúrico","barco","barítono","barómetro","barriga","base","basura","batalla","batería","batido","baya","bebé","bebida","béisbol","belleza","beneficio","bengala","bestia","biblia","biblioteca","bicicleta","bidé","bikini","binoculares","biología","blanco","blusa","bobina","boca","bocadillo","boina","bolera","bollo","bolo","bolsillo","bolso","bomba","bombón","bongo","bonsai","borrador","bota","botánica","botella","botín","botón","boxer","brandy","brasil","brazalete","brazo","breve","brillante","brisa","británico","brocha","broche","brócoli","bronce","bronquitis","brújula","buitre","bulbo","bullicio","bungalow","burbuja","butano","caballero","caballo","cabaña","cabina","cable","cacao","cactus","cadena","café","cafetería","caimán","caja","cajero","calcetín","cálculo","calendario","calesa","cáliz","callejón","calma","cama","cámara","cambio","camello","campana","campaña","campeón","canal","canapé","cáncer","candelabro","candidato","cangrejo","canica","canoa","cantidad","caña","cañón","caos","capa","capacidad","capilla","capital","capítulo","capucha","capuchino","cara","caracol","caramelo","caravana","carbón","carga","caridad","carne","carnicero","carpa","carpintero","carrera","carro","cartelera","cartílago","cartucho","cartulina","cascada","casino","castañuela","castillo","castor","catalizador","catamarán","catedral","categoría","cava","cazuela","cd","cebo","cebolla","cefalópodo","celeste","cementerio","cemento","cenador","cencerro","cenicero","ceniza","cenotafio","centavo","centímetro","centro","centurión","cepillo","cerbatana","cereal","cerebro","cerveza","cesta","chalet","chaparrón","chaqueta","charlatán","cheque","chico","chimpancé","china","chocolate","choque","chorro","chuleta","ciclo","ciego","científico","cigarra","cigarrillo","cilindro","cine","cinturón","circo","círculo","cirro","cita","ciudad","clarinete","clase","clásico","claustro","cláusula","clavel","clavícula","clavo","clérigo","click","cliente","clima","club","cobre","coche","cocina","cocodrilo","cóctel","código","cofre","cohete","cola","colegio","coliflor","coliseo","colisión","collar","colon","colonia","color","columna","columpio","coma","combate","comentario","comercial","cometa","cómic","comisión","comité","comodidad","cómodo","compañero","competencia","complejo","componente","compuesto","común","comunidad","concentrado","concepto","conciencia","concierto","concurso","conde","cóndor","conductor","conferencia","confianza","confitura","conflicto","conga","congreso","conífera","cono","consejo","consola","consonante","constante","constelación","cónsul","consulado","contacto","contagio","contenido","continente","contrario","contrato","copyright","coraza","corazón","corbata","corchete","corcho","cordón","corona","corral","correo","corresponsal","corriente","corte","cortina","cosecha","costa","creador","creativo","crédito","creencia","crema","cresta","cría","crimen","cristal","crítica","croissant","cromo","cronómetro","cuadrado","cuartel","cubierta","cucaracha","cuchara","cuchillo","cucurucho","cuenco","cuerda","cuerno","cuero","cuerpo","cueva","culpa","cultura","cumpleaños","cuna","cuñado","cúpula","curva","daga","dama","danza","debate","década","dedo","delantal","delincuente","desafío","desayuno","descanso","deuda","día","diamante","diario","diente","dinero","Dios","diputado","dirigible","disfraz","dormitorio","dragón","ducha","edad","edificio","efectivo","ejército","electricidad","elefante","embajada","embrague","empleado","empresa","encanto","enfermedad","enlace","entrada","entrenador","equipaje","error","escalada","escalera","escarabajo","esclavo","escoba","escote","escritorio","esfera","espacio","espada","espalda","espárrago","especia","espectro","espía","espiga","espiral","esqueleto","esquina","estadio","estallido","estela","estiércol","estómago","estrella","etiqueta","excavadora","explosivo","extranjero","factura","fagot","familia","fantasma","fénix","festival","fianza","figura","firma","flan","flauta","flecha","flor","folleto","fondo","Francia","freno","frente","frío","frontera","fruta","fuego","fuelle","fuerza","gafas","galleta","gargantilla","garrapata","gas","gato","gemelo","genio","gimnasio","globo","gorra","gracia","grado","gráfico","grande","granero","grifo","grillo","guante","guardarropa","guardería","guitarra","gusano","habitación","hebilla","helado","helicóptero","hermano","hermosa","héroe","hielo","hierro","himalaya","Hollywood","hombre","hongo","hora","hormiga","hormigón","horóscopo","hospital","hotel","hueco","huelga","hueso","huevo","iglesia","imán","impresora","incendio","india","infancia","Inglaterra","insecto","insignia","intento","intermitente","ira","jabalí","jardín","jaula","jefe","jeroglífico","judía","juego","Júpiter","ketchup","kiwi","laberinto","ladrillo","ladrón","lago","láser","lata","latón","lavabo","leche","lengua","lentilla","leopardo","libra","libro","lija","limón","limpiador","líquido","listón","llamada","llave","llegada","loco","lona","luna","Madrid","madurez","magdalena","maíz","malo","mancha","mando","manguera","mano","manojo","manta","mantequilla","manzana","mapa","marca","mariposa","mármol","marrón","martillo","más allá","masa","médico","mejilla","mendigo","menta","mesa","meteorito","microscopio","miel","miga","misil","mochila","modelo","moneda","monstruo","mora","mordedura","mosquito","mostrador","muerte","mujer","muleta","multitud","murciélago","nacimiento","nadando","naranja","negocio","negro","niebla","niña","niño","nota","novio","nube","Nueva York","nuez","oferta","ojo","ordenador","oreja","ornitólogo","oro","oruga","oso","otoño","pabellón","padre","país","pajarera","pajarita","pájaro","palillo","palo","pan","panadería","pantalones","pantano","pañuelo","papel","papelera","paracaídas","parachoque","paraguas","pareja","paréntesis","parque","parte","pasamontañas","pasaporte","pasillo","pastel","patata","patín","pato","pausa","payaso","pecho","peine","película","peligro","pelota","péndulo","pepino","perfume","perímetro","perro","personaje","pescado","petróleo","piano","pico","pie","pierna","piloto","pimienta","pirámide","pirata","piscina","pista","pistola","pizarra","plaga","planeta","plátano","playa","pluma","poco","policía","pollo","polluelo","polo","portón","pozo","premio","presidente","presupuesto","prima","primavera","princesa","prisión","promedio","publicidad","puente","puerto","pulpo","pulsera","puma","química","radar","radiografía","raíz","rama","raqueta","red","reloj","remolacha","réplica","restaurante","rey","rifle","rizo","robot","rock","ropa","rosquilla","ruleta","saco","sal","sala","salchicha","sangre","satélite","saturno","sello","seno","servidor","sexo","siglo","silla","sillón","simio","soborno","sofá","software","sol","soldado","solicitud","sólido","sombrero","somier","sotana","sótano","suelo","suerte","suma","tablero","taburete","taladradora","taller","talón","tambor","tarde","tarjeta","tarta","taza","teatro","techo","telaraña","telescopio","telesilla","televisión","templo","tenedor","tenis","termómetro","ternera","tesoro","tía","tienda","tierra","tigre","tijeras","tiza","tobillo","tocador","tocino","topógrafo","torero","tornillo","toro","torpedo","tos","trapo","trébol","tren","triángulo","tubo","túnel","Turquía","universidad","uña","uva","vaca","valiente","vampiro","vaquero","vejiga","vela","ventaja","ventana","ventilador","ventisca","vestido","viaje","vida","vídeo","villancico","violonchelo","Washington","web","yarda","zanahoria","zapato","zueco"];;
		if (adicional==0){
		    arr = shuffle(277,cartas); // Escogemos un orden aleatorio para las 277 cartas que hay disponibles. Pondremos en la mesa las [Nrows*Ncols] primeras
		}else{
		    arr = shuffle(words.length, cartas);
		}
		var r, c, i // declaramos las variables usadas en el for.
		$('#container-tablero').html("");
		for (r=0;r<Nrows;r++){ 			// Para cada fila
			for (c=0; c<Ncols; c++){ 	// Para cada columna 
				i = r*Ncols+c; 			// Este es el indice de la carta actual
				var s = '<div class="carta" style="height:' + carta_height + 'vh;" id="a' + i + '"  data-team="0" onclick="mostraroverlay('+ i + ')"><div class="overlay" id="b' + i + '"  style="visibility: hidden;"> <div onclick="mostraragente('+ i +')"> Revelar</div> <div onclick="ocultaroverlay('+ i +')"> Cancelar</div> </div> <div class="texto" style="margin-top:-' +carta_height/2 +'vh;"></div></div>';
				$('#container-tablero').html($('#container-tablero').html() + s);
				var x = document.getElementById("a" + i); // Este es el elemento de la carta actual
				x.style.backgroundColor = "#e9d9c9"; // Establecemos el color por defecto de las tarjetas
				if (adicional==0){
				    x.style.backgroundImage = "url('./gif/" + pad(arr[i],3) + ".gif')"; // Establecemos la imagen que ha tocado en el sorteo para esta posición
				}else{
				    $("#a" + i + "> .texto").html(words[arr[i]]);
				}
				x.style.backgroundSize  = 'contain'; 	// Hacemos que el dibujo quepa entero en la carta
				x.setAttribute('data-team',0); 			// Le forzamos el equipo 0 (civil), para que se asignen bien todos los equipos.
			}
		}
		var teams = shuffle(Nrows*Ncols,agentes); // Determinamos al azar un orden de cartas entre 1 y 20 (barajeadas). Las [azul] primeras serán las del equipo azul, las [rojo] siguientes serán del equipo rojo, la siguiente será el asesino y las restantes serán civiles.
		
		for (i=0; i<azul;i++){ 									// Las [azul] primeras cartas de teams serán del equipo azul
			var x = document.getElementById("a" + teams[i]); 	// escogemos el elemento correspondiente a la [i]-ésima carta que ha salido en teams
			x.setAttribute('data-team',1); 						// y le asignamos el equipo 1 (azul)
		}
		for (i=azul; i<(rojo+azul);i++){ 						// Las [rojo] siguientes serán del equipo azul
			var x = document.getElementById("a" + teams[i]); 	// escogemos el elemento correspondiente a la carta que ha salido en teams
			x.setAttribute('data-team',2); 						// y le asignamos el equipo 2 (rojo)
		}
		var x = document.getElementById("a" + teams[rojo+azul]);// La carta siguiente será el asesino
		x.setAttribute('data-team',3);							// asignamos el equipo 3 (asesino)
	}
	
	function informacion(){ // Esta función muestra un alert box diciendo qué equipo empieza
		var color = '';
		if (empieza_azul){
			color = 'azul';
		}else{
			color = 'rojo';
		}
		myalert('Empieza el equipo ' + color + '.', 'El icono de la esquina superior izquierda muestra el color del equipo que comienza jugando, en este caso el ' + color + '.\nEste equipo tendrá que adivinar una palabra más (8) por tener la ventaja de empezar.');
	}
	
	var ocultaroverlay_Last = -1; // una variable global que nos dice cuál ha sido la última carta en ocultaroverlay. Si ponemos -1, no ha sido ninguna.
	
	function mostraroverlay(inp){ // La función mostrar overlay nos va a mostrar el overlay en la carta seleccionada, pero sólo si no se acaba de ejecutar ocultaroverlay (esto sucede porque la función ocultaroverlay se ejecuta al pulsar en un botón que está encima del overlay, haciendo que se ejecute también mostrar overlay. Por esta razón, sólo mostramos el overlay si no se acaba de ejeutar ocultaroverlay en esta carta)
		for (i=0; i<20+5*adicional; i++){ // Para todas las cartas que hay en la mesa
			document.getElementById('b' + i).style.visibility = 'hidden'; // ocultamos su overlay
		}
		if (ocultaroverlay_Last!== inp){ // Si no se acaba de ejecutar ocultar en esta carta
			document.getElementById('b' + inp).style.visibility = 'visible'; // mostramos este overlay
		}
		ocultaroverlay_Last = -1; // decimos la última carta en la que se ejeutó ocultaroverlay es -1, para que no sea ninguna (ya que lo último que se ha ejecutado ha sido mostraroverlay)
	}
	
	function ocultaroverlay(inp){ // La función ocultaroverlay nos oculta el overlay que aparece encima de cada carta
		var x = document.getElementById("a" + inp);
		
		if (adicional==0){
		    x.style.backgroundImage = "url('./gif/" + pad(arr[inp],3) + ".gif')"; // Establecemos la imagen que ha tocado en el sorteo para esta posición
		}else{
		    x.style.backgroundImage = "none";
		    $("#a" + inp + "> .texto").html(words[arr[inp]]);
		}
		x.style.backgroundSize = "contain";
		document.getElementById('b' + inp).style.visibility = 'hidden'; // Ocultamos el overlay seleccionado
		ocultaroverlay_Last = inp; // indicamos cuál es el que se ha clicado en último lugar para que no se vuelva a ejecutar el mostraroverlay por haber hecho click dentro de la zona de mostraroverlay.
	}
	
	function mostraragente(inp, no_agente){ // Esta función nos muestra el agente que hay detrás de una carta o si la variable no_agente vale 1, nos muestra un fondo en cada carta para indicar a qué equipo pertenece (tarjeta de código). Llama a ocultaroverlay
		
		no_agente = no_agente || 0; // Esta variable es opcional. Si se pone a 1 quiere decir que lo que queremos es revelar todos los códigos para la carta de pistas
		ocultaroverlay(inp); // Al ejecutar esta función, evidentemente tenemos que ocultar el overlay porque no queremos que se quede ahí.
		
		var col = '#cfb88e'; // definimos un color de fondo por defecto (amarillo para los civiles)
		var name = '';       // definimos una ruta para la imagen a mostrar en esta carta (vacío de momento)
		var x = document.getElementById('a' + inp); // Localizamos la carta a la que nos referimos
		
		var team = x.getAttribute('data-team'); // determinamos el equipo al que pertenece la carta escogida...
		var face = Math.round(Math.random()*1);   // Hay dos caras para algunos personajes (agentes rojos, agentes azules y civiles). Sorteamos la cara que tiene que salir (0 o 1).

		if (team==0){ col = '#cfb88e'; name = "url('./agents/0" + face + ".jpg')"; } // Si es el equipo 0 (civil), el color de fondo es amarillo y la tarjeta es la cara de un civil (00.jpg o 01.jpg)
		if (team==1){ col = '#51719a'; name = "url('./agents/1" + face + ".jpg')"; } // Si es el equipo 1 (azul), el color de fondo es azul y la tarjeta es la cara de un agente azul (10.jpg o 11.jpg)
		if (team==2){ col = '#ea5f28'; name = "url('./agents/2" + face + ".jpg')"; } // Si es el equipo 2 (rojo), el color de fondo es rojo y la tarjeta es la cara de un agente rojo (20.jpg o 21.jpg)
		if (team==3){ col = '#444444'; name = "url('./agents/3.jpg')";}	// Si es el equipo 3 (asesino), el color de fondo es negro y la tarjeta es la cara del asesino (3.jpg)
		
		if (no_agente){ // Si no queremos que se muestre el agente, sino sólo el código de color
			x.style.backgroundColor   = col;   		// Establecemos el color de fondo 
			x.style.backgroundSize    = 'contain';  // Decimos que la imagen tiene que caber entera en la carta (se sigue mostrando la imagen de adivinar)
		}else{ // Si queremos que se muestre el agente
			x.style.backgroundImage   = name;    // Establecemos la imagen del agente de fondo
			x.style.backgroundSize    = 'cover'; // E indicamos que la imagen tiene que cubrir toda la carta
			$("#a" + inp + "> .texto").html("");
		}
	}
	
	function mostrarSelector(){ // Esta función se ejecuta al pulsar en el botón actualizar para mostrar el selector de tablero o código)
		var tabl = document.getElementById('container-tablero'); // El tablero
		tabl.style.visibility = 'hidden'; 	// Lo ocultamos
		tabl.style.display = 'none'; 		// No lo mostramos
		
		var slec = document.getElementById('container-selector'); // El selector
		slec.style.visibility = 'visible'; 	// Lo hacemos visible
		slec.style.display = 'block'; 		// Lo mostramos
		
		var icn = document.getElementById('icon_left');
		icn.style.backgroundImage = 'none';
		icn.style.backgroundColor = "";
		icn.onclick = function(e){};
	}
	
	function mostrarTablero(){ // Esta función se ejecuta al pulsar en el selector de "Este dispositivo es el Tablero" (es decir, mostrar las cartas). Llama a la función tablero
		var slec = document.getElementById('container-selector'); // El selector
		slec.style.visibility = 'hidden'; 	// Lo ocultamos
		slec.style.display = 'none'; 		// No lo mostramos
		
		var tabl = document.getElementById('container-tablero'); // El tablero
		tabl.style.visibility = 'visible'; 	// Lo hacemos visible
		tabl.style.display = 'block'; 		// Lo mostramos
		tablero();
		
		iconLeft = document.getElementById('icon_left');
		iconLeft.style.backgroundImage = "url('./img/play.png')";
		iconLeft.style.backgroundColor = "#222";
		iconLeft.style.visibility = 'visible';
		iconLeft.style.display = 'block'; 		// Lo mostramos
		iconLeft.onclick = function(e) {pulsar_musica();};
	}
	
	var EstaTarjetaEsCodigo = false; //De inicio asumimos que esta tarjeta no es de código, sino que es de tablero
	function mostrarCodigo(){ // Esta función se ejecuta al pulsar en el selector de "Este dispositivo es la Tarjeta de Código Secreto" (mostramos las cartas, pero revelamos a qué equipo pertenece cada una). Llama a mostraragente y a mostrarTablero.
		EstaTarjetaEsCodigo = true; // Decimos que esta es la tarjeta de código
		mostrarTablero(); // Además mostramos el tablero
		
		var icon = '';
		if (empieza_azul){
			icon = "url('./img/blue.png')";
		}else{
			icon = "url('./img/red.png')";
		}
		iconLeft = document.getElementById('icon_left');
		iconLeft.style.backgroundImage = icon;
		iconLeft.style.backgroundColor = "";
		iconLeft.onclick = function(e) {informacion();};
		
		for (i=0; i<20+5*adicional; i++){
			mostraragente(i,1); // Para todas las cartas establecemos el equipo al que pertenece (pero le indicamos mediante un 1 que no muestre el agente, sino el color del equipo)
		}
	}
	
	function establecerSemilla(){ // Esta función pone un código de semilla en la caja
		var ts = Math.round((new Date()).getTime() / 30000);
		var semillas = new MersenneTwister(ts);
		var seed = Math.round(semillas.random()*4294967296);
		setTablero(seed);
	}
	
	function ventanaCompleta(){ // Esta función activa y desactiva el modo ventana completa
		var x =	document.getElementById("fondo");
		var isInFullScreen = (document.fullscreenElement && document.fullscreenElement !== null) ||
			(document.webkitFullscreenElement && document.webkitFullscreenElement !== null) ||
			(document.mozFullScreenElement && document.mozFullScreenElement !== null) ||
			(document.msFullscreenElement && document.msFullscreenElement !== null);

		if (!isInFullScreen) {
			if (x.requestFullscreen) {
				x.requestFullscreen();
			} else if (x.mozRequestFullScreen) {
				x.mozRequestFullScreen();
			} else if (x.webkitRequestFullScreen) {
				x.webkitRequestFullScreen();
			} else if (x.msRequestFullscreen) {
				x.msRequestFullscreen();
			}
			var icon_url = "url('./img/min2.png')";
		} else {
			if (document.exitFullscreen) {
				document.exitFullscreen();
			} else if (document.webkitExitFullscreen) {
				document.webkitExitFullscreen();
			} else if (document.mozCancelFullScreen) {
				document.mozCancelFullScreen();
			} else if (document.msExitFullscreen) {
				document.msExitFullscreen();
			}
			var icon_url = "url('./img/max2.png')";
		}
		var i =	document.getElementById("icon_right");
		i.style.backgroundImage = icon_url;
	}
	
	function setTablero(num){ // pone la semilla (texto) que corresponde al código de tiempo en la caja. Llama a num2seed
		document.getElementById('tablero').value = num2seed(num);
	}
	
	function getTablero(){ // nos devuelve el número correspondiente a la semilla usada. Llama a seed2num
		var str = document.getElementById('tablero').value;
		var numero = seed2num(str);
		return numero;
	}
	
	// variables para pasar de texto a número
	var cadena = 'ABCDEFGHJKLMNPQRSTUVWXYZ123456789';
	var base = cadena.length;
	
	function num2seed(x){ //Esta función nos convierte una semilla de número a texto
		var a = 0;
		var result = '';
		while(x>0){
			a = x % base;
			x = (x-a)/base;
			result += cadena.charAt(a);
		}
		return result;
	}
	
	function seed2num(str){ //Esta función nos convierte una semilla de texto a número
		var result2 = str.toUpperCase();
		var cadena2 = cadena.toUpperCase();
		var n = result2.length;
		
		var w = 0;
		for (var i=0; i<n; i++){
			w += cadena2.indexOf(result2.charAt(i))*Math.pow(base,i);
		}
		return w;
	}
	
	
	function novedades(){
		myalert("Novedades",'<u>15-Mar-2020:</u>\nAlgunas partidas son con palabras en lugar de imágenes.\nSe puede elegir que sean sólo imágenes o sólo palabras.\n<u>22-Dic-2017:</u>\nSe ha añadido un reproductor de música de fondo en la ventana de tablero.\nAhora se puede jugar con el móvil en vertical.\n<u>07-Ago-2017:</u>\nEl botón de "Nueva partida" ahora permite iniciar una nueva partida sin tener que recargar la página, lo que permitirá ahorrar datos y usar la página de manera más intuitiva.\nAl pulsar el botón "Nueva partida", se renovará el número de juego y se mostrará el selector de tipo de dispositivo (esta pantalla) de nuevo si el número de juego cambia.\nSi se quiere usar un número de juego en concreto, hay que escribirlo antes de pulsar en "Tablero de cartas" o "Tarjeta de código secreto".\nEl número de juego ahora está compuesto por letras (salvo la I, la Ñ y la O) y números (salvo el 0).\nEl botón de "ventana completa" se ha estilizado y es dinámico en función del estado de la ventana.');
	}
	
	function cerrar_ventana(id_elemento){
		var slec = document.getElementById(id_elemento); // El selector
		slec.style.visibility = 'hidden'; 	// Lo ocultamos
		slec.style.display = 'none'; 		// No lo mostramos
		//ventanaCompleta(); // ponemos ventana completa
	}
	
	function myalert(titulo,mensaje){
		var caja = document.getElementById('mensaje1'); // La caja
		var titl = document.getElementById('mensaje1_titulo'); // El titulo
		var mnsj = document.getElementById('mensaje1_contenido'); //El contenido
		
		caja.style.visibility = 'visible'; 	// Lo hacemos visible
		caja.style.display = 'block'; 		// Lo mostramos
		titl.innerHTML = htmlizar(titulo);
		mnsj.innerHTML = htmlizar(mensaje);
	}
	
	function htmlizar(texto){
		texto = texto.replace(/\n/g,'</br></br>');
		texto = texto.replace(/á/g,'&aacute;');
		texto = texto.replace(/é/g,'&eacute;');
		texto = texto.replace(/í/g,'&iacute;');
		texto = texto.replace(/ó/g,'&oacute;');
		texto = texto.replace(/ú/g,'&uacute;');
		return texto;
	}
	
	function GiroPantalla() {
		x = document.getElementById('girar-telefono');
		n = window.orientation;
		if (n==0 || n==180){
			x.style.visibility = 'hidden'; 	// Lo hacemos visible (visible)
			x.style.display = 'none'; 		// Lo mostramos (block)
		}
		else{
			x.style.visibility = 'hidden'; 	// Lo hacemos visible
			x.style.display = 'none'; 		// Lo mostramos
		}
	}
	
	// Sonido de fondo
	var sonando = false;
	var song      = document.getElementById('cancion');
	var playpause = document.getElementById("icon_left");
	var file      = document.getElementById('fichero');
	var rep       = document.getElementById('repeat');
	var shu       = document.getElementById('shuffle');
	
	/*
	var folder = "./music_test/";
	var songlist = ["test.mp3","11.mp3","22.mp3","33.mp3"];
	*/
	
	var folder = "./music/";
	var songlist = ["ryan_andersen_-_01_-_warmin_up.mp3","ryan_andersen_-_02_-_please_dont_go.mp3","ryan_andersen_-_03_-_sweet_love.mp3","ryan_andersen_-_04_-_stairwell.mp3","ryan_andersen_-_05_-_wastin_time.mp3","ryan_andersen_-_06_-_think_about_it.mp3","ryan_andersen_-_07_-_happiness_is.mp3","jahzzar_-_10_-_take_me_higher.mp3"];
	
	var numsongs = songlist.length;
	var rand = 0;
	var songidx = Math.floor(Math.random()*numsongs);
	
	song.src = folder + songlist[songidx];
	
	var listacanciones = Array.apply(null, Array(numsongs)).map(function (x, i) { return ((i+songidx) % numsongs); });
	//lista_canciones();
	
	var repeat  = 1;
	var shuffle_song = false;
	
	function lista_canciones(){
		listacanciones = Array.apply(null, Array(numsongs)).map(function (x, i) { return ((i+songidx) % numsongs); });
	}
	
	function pulsar_musica() {
	  if (!sonando) {
		song.play();
		playpause.style.backgroundImage = "url('./img/bars.gif')";
	  }else{
		song.pause();
		playpause.style.backgroundImage = "url('./img/play.png')";
	  }
	  sonando=!sonando;
	}
	
	function acabada(){
		if (sonando){
			next_song();
			playpause.style.backgroundImage = "url('./img/bars.gif')";
			song.src = folder + songlist[listacanciones[songidx]];
			song.play();
		}else{
			songidx = 0;
			playpause.style.backgroundImage = "url('./img/play.png')";
			song.src = folder + songlist[listacanciones[songidx]];
		}
	}
	
	function next_song(){
		songidx++; // pasamos a la siguiente cancion
		if (repeat==2){ // si es repeat one
			songidx--; // volvemos a la canción en la que estábamos
		}else if (repeat==1){ // si es repeat todas
			songidx = (songidx) % numsongs; // volvemos a empezar
		}else if (songidx>=numsongs-1){ // si no hay repeat y estamos en la última canción
			sonando = false; // deja de sonar después de esta
		}
	}
	
	//GiroPantalla();
	//window.addEventListener('orientationchange', GiroPantalla);
	establecerSemilla(); // establecemos una semilla en función de la hora
	//novedades();

</script>
</body>

</html>